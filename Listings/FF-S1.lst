C51 COMPILER V9.59.0.0   FF_S1                                                             03/04/2021 08:36:50 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE FF_S1
OBJECT MODULE PLACED IN .\Objects\FF-S1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE FF-S1.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\FF-
                    -S1.lst) TABS(2) OBJECT(.\Objects\FF-S1.obj)

line level    source

   1          //-----------------------------------------------------------------------------
   2          // TP5.c
   3          //-----------------------------------------------------------------------------
   4          // AUTH: 
   5          // DATE: 
   6          //
   7          // Target: C8051F02x
   8          // Tool chain: KEIL Microvision 4
   9          //
  10          //-----------------------------------------------------------------------------
  11          #include <C8051F020.h>
  12          #include "c8051F020_SFR16.h"
  13          #include "TP5_Lib_Config_Globale_8051F020.h"
*** WARNING C318 IN LINE 13 OF FF-S1.c: can't open file 'TP5_Lib_Config_Globale_8051F020.h'
  14          #include "TP5_Lib_Divers.h"
*** WARNING C318 IN LINE 14 OF FF-S1.c: can't open file 'TP5_Lib_Divers.h'
  15          
  16          sbit FREQ_OUT = P3^2;
  17          sbit CHG_FREQ = P2^2;
  18          sbit LED = P1^6;
  19          sbit BOUTON = P3^7;
  20          int i=1;
  21          
  22          #define Reset_Timer3Overflow TMR3CN &= 0x04
  23          #define Disable_Timer3 TMR3CN = 0x00
  24          #define Reset_Timer2External EXF2 = 0
  25          // Prototypes de Fonctions
  26          
  27          //MODE DE FONCTIONNEMENT
  28          // On utilise timer3 comme générateur de signaux parce qu'il ne peut faire que l'auto rechargement 16bits,
             - ce qui est uniquement utile pour ce cas de figure
  29          // On est obligé de faire ça car sinon il ne restera plus assez de timers pour la capture(tâche1) et le ba
             -ud-rate generator(tâche2)
  30          // On utilise timer 2 en mode capture pour gérer le changement de fréquence
  31          //Le changement se fait dans son ISR. Il y a beaucoup de ports à allouer et de crossbar à écrire, et il y 
             -a pas moyen de vérifier sans carte devant soi :/
  32          
  33          
  34          
  35          
  36          
  37          void Phase_Usage(void){
  38   1        if (BOUTON == 1){ //A refaire avec des flags
  39   2          //Disable_Timer3;
  40   2        }
  41   1      }
  42          //-----------------------------------------------------------------------------
  43          //-----------------------------------------------------------------------------
  44          // MAIN Routine
  45          //-----------------------------------------------------------------------------
  46          void main (void) {
  47   1             
  48   1          Init_Device();  // Appel des configurations globales
*** WARNING C206 IN LINE 48 OF FF-S1.c: 'Init_Device': missing function-prototype
C51 COMPILER V9.59.0.0   FF_S1                                                             03/04/2021 08:36:50 PAGE 2   

  49   1          
  50   1      // Début Insertion Code Configuration des périphériques ***********************
  51   1       
  52   1        
  53   1      // Fin Code Initialisations ***************************************************
  54   1      
  55   1        
  56   1      // Début Insertion Code Phase Démarrage *************************************** 
  57   1            EA = 1;
  58   1            TMR3RL = 0xD8EF;  //10kHz à 0xFF98 1kHz à 0xFFCE 100Hz à 0xFE0B
  59   1            TMR3CN = 0x04; //Timer 3 est enabled
  60   1            T2CON = 0xF; //Timer 2 actif en auto-reload, en mode compteur, avec captures autorisées
  61   1        // Fin Code phase Démarrage ***************************************************
  62   1        
  63   1        
  64   1        while(1)
  65   1              {
  66   2                Phase_Usage();
  67   2              }                       
  68   1      }
  69          
  70          //-----------------------------------------------------------------------------
  71          //-----------------------------------------------------------------------------
  72          // Fonctions de configuration des divers périphériques
  73          //-----------------------------------------------------------------------------
  74          // Insérez vos fonctions de configuration ici
  75          
  76          //-----------------------------------------------------------------------------
  77          //-----------------------------------------------------------------------------
  78          // Fonctions d'interruptions
  79          //-----------------------------------------------------------------------------
  80          // Insérez vos fonctions d'interruption ici
  81          void ISR_timer3Overflow() interrupt 14
  82          {
  83   1      //Générateur de signaux
  84   1        FREQ_OUT = !FREQ_OUT;
  85   1        Reset_Timer3Overflow;
  86   1      }
  87          
  88          void ISR_timer2External() interrupt 5
  89          {
  90   1        Reset_Timer2External;
  91   1        if (i==0){
  92   2          i=i+1;
  93   2          TMR3RL = 0xD8EF; //100Hz
  94   2        }
  95   1        if (i==1){
  96   2          i=i+1;
  97   2          TMR3RL = 0xFC17; //1kHz
  98   2        }
  99   1        if (i==2){
 100   2          TMR3RL = 0xFF98; //10kHz
 101   2          i=0;
 102   2        }
 103   1        
 104   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     96    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   FF_S1                                                             03/04/2021 08:36:50 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
